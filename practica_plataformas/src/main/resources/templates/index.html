<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gestor de Estudiantes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container mt-5">

    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">

            <h2 class="text-center mb-4">Gestor de Estudiantes (REST API)</h2>

            <div class="card p-4 mb-4 shadow">
                <div class="mb-3">
                    <label for="id" class="form-label">ID:</label>
                    <input type="number" id="id" class="form-control" placeholder="Ej: 1" required min="1" step="1">
                </div>
                <div class="mb-3">
                    <label for="name" class="form-label">Nombre:</label>
                    <input type="text" id="name" class="form-control" placeholder="Nombre completo" required>
                </div>
                <div class="mb-3">
                    <label for="carrera" class="form-label">Carrera:</label>
                    <input type="text" id="carrera" class="form-control" placeholder="Ej: Ingeniería de Sistemas" required>
                </div>
                <button onclick="agregarEstudiante()" class="btn btn-success w-100 py-2">
                    Crear Estudiante
                </button>
            </div>

            <h5 class="mt-4 mb-3">Lista de estudiantes registrados</h5>
            <div class="list-group shadow-sm" id="estudiantesList">
                <div class="list-group-item text-center text-muted">
                    Cargando estudiantes...
                </div>
            </div>

        </div>
    </div>

    <script>
        window.onload = function () {
            cargarEstudiantes();
        };

        // GET /api/users  → lista estudiantes
        function cargarEstudiantes() {
            fetch('/api/users')
                .then(response => {
                    if (!response.ok) throw new Error('Error al cargar los estudiantes');
                    return response.json();
                })
                .then(estudiantes => {
                    const container = document.getElementById('estudiantesList');

                    if (estudiantes.length === 0) {
                        container.innerHTML = `
                            <div class="list-group-item text-center text-muted">
                                No hay estudiantes registrados todavía
                            </div>`;
                        return;
                    }

                    container.innerHTML = estudiantes.map(e => `
                        <div class="list-group-item">
                            <strong>ID:</strong> ${e.id}  
                            <strong>→</strong> ${e.name}  
                            <br>
                            <small class="text-muted">Carrera:</small> ${e.carrera || 'No especificada'}
                        </div>
                    `).join('');
                })
                .catch(error => {
                    console.error(error);
                    document.getElementById('estudiantesList').innerHTML = `
                        <div class="alert alert-danger text-center">
                            No se pudieron cargar los estudiantes
                        </div>`;
                });
        }

        // POST /api/users  → crea estudiante
        function agregarEstudiante() {
            const idInput      = document.getElementById('id');
            const nameInput    = document.getElementById('name');
            const carreraInput = document.getElementById('carrera');

            const id      = idInput.value.trim();
            const name    = nameInput.value.trim();
            const carrera = carreraInput.value.trim();

            if (!id || !name || !carrera) {
                alert('Por favor completa todos los campos');
                return;
            }

            const nuevoEstudiante = {
                id: parseInt(id),
                name: name,
                carrera: carrera
            };

            fetch('/api/users', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(nuevoEstudiante)
            })
            .then(response => {
                if (response.status === 201) {
                    alert('Estudiante creado exitosamente');
                    idInput.value = '';
                    nameInput.value = '';
                    carreraInput.value = '';
                    cargarEstudiantes();
                    return;
                }

                if (response.status === 409) {
                    alert('Error: Ya existe un estudiante con ese ID');
                    return;
                }

                // Otros errores
                return response.text().then(msg => {
                    throw new Error(msg || `Error inesperado (${response.status})`);
                });
            })
            .catch(error => {
                console.error(error);
                alert('No se pudo crear el estudiante:\n' + error.message);
            });
        }
    </script>
</body>
</html>